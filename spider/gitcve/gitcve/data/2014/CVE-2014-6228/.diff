diff --git a/hphp/runtime/base/zend-string.cpp b/hphp/runtime/base/zend-string.cpp
index c40a9469f148..7b64a9a924f1 100644
--- a/hphp/runtime/base/zend-string.cpp
+++ b/hphp/runtime/base/zend-string.cpp
@@ -626,8 +626,14 @@ String string_chunk_split(const char *src, int srclen, const char *end,
   int chunks = srclen / chunklen; // complete chunks!
   int restlen = srclen - chunks * chunklen; /* srclen % chunklen */
 
-  int out_len = (chunks + 1) * endlen + srclen;
-  String ret(out_len, ReserveString);
+  String ret(
+    safe_address(
+      chunks + 1,
+      endlen,
+      srclen
+    ),
+    ReserveString
+  );
   char *dest = ret.bufferSlice().ptr;
 
   const char *p; char *q;
diff --git a/hphp/test/slow/ext_string/chunk_split_overflow.php b/hphp/test/slow/ext_string/chunk_split_overflow.php
new file mode 100644
index 000000000000..c895bee3639e
--- /dev/null
+++ b/hphp/test/slow/ext_string/chunk_split_overflow.php
@@ -0,0 +1,3 @@
+<?php
+
+chunk_split(str_repeat('*', 2000000), 1.0, str_repeat('*', 2000000));
diff --git a/hphp/test/slow/ext_string/chunk_split_overflow.php.expectf b/hphp/test/slow/ext_string/chunk_split_overflow.php.expectf
new file mode 100644
index 000000000000..17c953f9163a
--- /dev/null
+++ b/hphp/test/slow/ext_string/chunk_split_overflow.php.expectf
@@ -0,0 +1,2 @@
+
+Fatal error: String length exceeded 2^31-2: 4000004000000 in %s on line 3
